"use strict";
var app = getApp();
Page({
    data: {
        motto: 'Hello World',
        userInfo: {},
        hasUserInfo: false,
        canIUse: wx.canIUse('button.open-type.getUserInfo'),
        year: 0,
        month: 0,
        date: ['日', '一', '二', '三', '四', '五', '六'],
        dateArr: [],
        todayStr: '',
        isTodayWeek: false,
        todayIndex: 0,
        btnText: '来啦来啦'
    },
    bindViewTap: function () {
        wx.navigateTo({
            url: '../logs/logs',
        });
    },
    onLoad: function () {
        var _this = this;
        if (app.globalData.userInfo) {
            this.setData({
                userInfo: app.globalData.userInfo,
                hasUserInfo: true,
            });
        }
        else if (this.data.canIUse) {
            app.userInfoReadyCallback = function (res) {
                _this.setData({
                    userInfo: res.userInfo,
                    hasUserInfo: true,
                });
            };
        }
        else {
            wx.getUserInfo({
                success: function (res) {
                    app.globalData.userInfo = res.userInfo;
                    _this.setData({
                        userInfo: res.userInfo,
                        hasUserInfo: true,
                    });
                },
            });
        }
        var now = new Date();
        var year = now.getFullYear();
        var month = now.getMonth();
        var date = new Date().getDate();
        this.dateInit(year, month);
        this.setData({
            year: year,
            month: month + 1,
            todayStr: '' + year + (month > 10 ? month + 1 : '0' + (month + 1)) + (date < 9 ? '0' + date : date)
        });
    },
    dateInit: function (setYear, setMonth) {
        var _this = this;
        var dateArr = [];
        var arrLen = 0;
        var now = setYear ? new Date(setYear, setMonth) : new Date();
        var year = setYear || now.getFullYear();
        var nextYear = 0;
        var month = setMonth || now.getMonth();
        var nextMonth = (month + 1) > 11 ? 1 : (month + 1);
        var startWeek = new Date(year + ',' + (month + 1) + ',' + 1).getDay();
        var dayNums = new Date(year, nextMonth, 0).getDate();
        var obj = {};
        var num = 0;
        if (month + 1 > 11) {
            nextYear = year + 1;
            dayNums = new Date(nextYear, nextMonth, 0).getDate();
        }
        arrLen = startWeek + dayNums;
        for (var i = 0; i < arrLen; i++) {
            if (i >= startWeek) {
                num = i - startWeek + 1;
                obj = {
                    todayStr: '' + year + (month > 10 ? month + 1 : '0' + (month + 1)) + (num > 9 ? num : '0' + num),
                    dateNum: num,
                    weight: 5
                };
            }
            else {
                obj = {};
            }
            dateArr[i] = obj;
        }
        this.setData({
            dateArr: dateArr
        }, function () {
            _this.rebuildDateArr();
        });
        var nowDate = new Date();
        var nowYear = nowDate.getFullYear();
        var nowMonth = nowDate.getMonth() + 1;
        var nowWeek = nowDate.getDay();
        var getYear = setYear || nowYear;
        var getMonth = setMonth >= 0 ? (setMonth + 1) : nowMonth;
        if (nowYear == getYear && nowMonth == getMonth) {
            this.setData({
                isTodayWeek: true,
                todayIndex: nowWeek
            });
        }
        else {
            this.setData({
                isTodayWeek: false,
                todayIndex: -1
            });
        }
    },
    lastMonth: function () {
        var year = this.data.month - 2 < 0 ? this.data.year - 1 : this.data.year;
        var month = this.data.month - 2 < 0 ? 11 : this.data.month - 2;
        this.setData({
            year: year,
            month: (month + 1)
        });
        this.dateInit(year, month);
    },
    nextMonth: function () {
        var year = this.data.month > 11 ? this.data.year + 1 : this.data.year;
        var month = this.data.month > 11 ? 0 : this.data.month;
        this.setData({
            year: year,
            month: (month + 1)
        });
        this.dateInit(year, month);
    },
    rebuildDateArr: function () {
        var checkedDate = this.getCheckedDate();
        var dateArr = this.data.dateArr.map(function (item) {
            if (item.todayStr) {
                item.isChecked = checkedDate.indexOf(item.todayStr) !== -1;
                return item;
            }
        });
        this.setData({ dateArr: dateArr });
    },
    onClickDate: function () {
        console.log('onClickDate');
    },
    getCheckedDate: function () {
        console.log('getCheckedDate');
        return [
            "20200111",
            "20200112",
            "20200113",
            "20200114",
            "20200115",
            "20200116",
            "20200119"
        ];
    },
    getUserInfo: function (e) {
        console.log(e);
        app.globalData.userInfo = e.detail.userInfo;
        this.setData({
            userInfo: e.detail.userInfo,
            hasUserInfo: true,
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBRUEsSUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFjLENBQUE7QUFRaEMsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFFLGFBQWE7UUFDcEIsUUFBUSxFQUFFLEVBQUU7UUFDWixXQUFXLEVBQUUsS0FBSztRQUNsQixPQUFPLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQztRQUVuRCxJQUFJLEVBQUUsQ0FBQztRQUNQLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO1FBQ3pDLE9BQU8sRUFBTyxFQUFFO1FBQ2hCLFFBQVEsRUFBRSxFQUFFO1FBQ1osV0FBVyxFQUFFLEtBQUs7UUFDbEIsVUFBVSxFQUFFLENBQUM7UUFDYixPQUFPLEVBQUUsTUFBTTtLQUNoQjtJQUVELFdBQVc7UUFDVCxFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1osR0FBRyxFQUFFLGNBQWM7U0FDcEIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUNELE1BQU07UUFBTixpQkE0Q0M7UUFyQ0MsSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRTtZQUMzQixJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNYLFFBQVEsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLFFBQVE7Z0JBQ2pDLFdBQVcsRUFBRSxJQUFJO2FBQ2xCLENBQUMsQ0FBQTtTQUNIO2FBQU0sSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUc1QixHQUFHLENBQUMscUJBQXFCLEdBQUcsVUFBQSxHQUFHO2dCQUM3QixLQUFJLENBQUMsT0FBTyxDQUFDO29CQUNYLFFBQVEsRUFBRSxHQUFHLENBQUMsUUFBUTtv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QUFVO1lBQ1YsVUFBVTtTQUNYLENBQUE7SUFDSCxDQUFDO0lBQ0QsV0FBVyxZQUFDLENBQU07UUFDaEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNkLEdBQUcsQ0FBQyxVQUFVLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFBO1FBQzNDLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxRQUFRLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRO1lBQzNCLFdBQVcsRUFBRSxJQUFJO1NBQ2xCLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbmRleC50c1xuLy8g6I635Y+W5bqU55So5a6e5L6LXG5jb25zdCBhcHAgPSBnZXRBcHA8SUFwcE9wdGlvbj4oKVxuXG5pbnRlcmZhY2UgRGF0ZUFyciB7XG4gIHRvZGF5U3RyOiBzdHJpbmcsXG4gIGRhdGVOdW06IG51bWJlcixcbiAgd2VpZ2h0OiBudW1iZXIsXG4gIGlzQ2hlY2tlZD86IGJvb2xlYW5cbn1cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgbW90dG86ICdIZWxsbyBXb3JsZCcsXG4gICAgdXNlckluZm86IHt9LFxuICAgIGhhc1VzZXJJbmZvOiBmYWxzZSxcbiAgICBjYW5JVXNlOiB3eC5jYW5JVXNlKCdidXR0b24ub3Blbi10eXBlLmdldFVzZXJJbmZvJyksXG4gICAgLy8g5pel5Y6G5Y+C5pWwXG4gICAgeWVhcjogMCxcbiAgICBtb250aDogMCxcbiAgICBkYXRlOiBbJ+aXpScsICfkuIAnLCAn5LqMJywgJ+S4iScsICflm5snLCAn5LqUJywgJ+WFrSddLFxuICAgIGRhdGVBcnI6IDxhbnk+W10sXG4gICAgdG9kYXlTdHI6ICcnLFxuICAgIGlzVG9kYXlXZWVrOiBmYWxzZSxcbiAgICB0b2RheUluZGV4OiAwLFxuICAgIGJ0blRleHQ6ICfmnaXllabmnaXllaYnXG4gIH0sXG4gIC8vIOS6i+S7tuWkhOeQhuWHveaVsFxuICBiaW5kVmlld1RhcCgpIHtcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogJy4uL2xvZ3MvbG9ncycsXG4gICAgfSlcbiAgfSxcbiAgb25Mb2FkKCkge1xuICAgIC8vIHd4LnNldFRhYkJhclN0eWxlKHtcbiAgICAvLyAgIGNvbG9yOiAnI0ZGMDAwMCcsXG4gICAgLy8gICBzZWxlY3RlZENvbG9yOiAnIzAwRkYwMCcsXG4gICAgLy8gICBiYWNrZ3JvdW5kQ29sb3I6ICcjMDAwMEZGJyxcbiAgICAvLyAgIGJvcmRlclN0eWxlOiAnd2hpdGUnXG4gICAgLy8gfSlcbiAgICBpZiAoYXBwLmdsb2JhbERhdGEudXNlckluZm8pIHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHVzZXJJbmZvOiBhcHAuZ2xvYmFsRGF0YS51c2VySW5mbyxcbiAgICAgICAgaGFzVXNlckluZm86IHRydWUsXG4gICAgICB9KVxuICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhLmNhbklVc2UpIHtcbiAgICAgIC8vIOeUseS6jiBnZXRVc2VySW5mbyDmmK/nvZHnu5zor7fmsYLvvIzlj6/og73kvJrlnKggUGFnZS5vbkxvYWQg5LmL5ZCO5omN6L+U5ZueXG4gICAgICAvLyDmiYDku6XmraTlpITliqDlhaUgY2FsbGJhY2sg5Lul6Ziy5q2i6L+Z56eN5oOF5Ya1XG4gICAgICBhcHAudXNlckluZm9SZWFkeUNhbGxiYWNrID0gcmVzID0+IHtcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICB1c2VySW5mbzogcmVzLnVzZXJJbmZvLFxuICAgICAgICAgIGhhc1VzZXJJbmZvOiB0cnVlLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyDlnKjmsqHmnIkgb3Blbi10eXBlPWdldFVzZXJJbmZvIOeJiOacrOeahOWFvOWuueWkhOeQhlxuICAgICAgd3guZ2V0VXNlckluZm8oe1xuICAgICAgICBzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICAgIGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvID0gcmVzLnVzZXJJbmZvXG4gICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgIHVzZXJJbmZvOiByZXMudXNlckluZm8sXG4gICAgICAgICAgICBoYXNVc2VySW5mbzogdHJ1ZSxcbiAgICAgICAgICB9KVxuICAgICAgICB9LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBsZXQgbm93ID0gbmV3IERhdGUoKTtcbiAgICBsZXQgeWVhciA9IG5vdy5nZXRGdWxsWWVhcigpO1xuICAgIGxldCBtb250aCA9IG5vdy5nZXRNb250aCgpO1xuICAgIGxldCBkYXRlID0gbmV3IERhdGUoKS5nZXREYXRlKCk7XG4gICAgdGhpcy5kYXRlSW5pdCh5ZWFyLCBtb250aCk7XG4gICAgdGhpcy5zZXREYXRhKHtcbiAgICAgIHllYXI6IHllYXIsXG4gICAgICBtb250aDogbW9udGggKyAxLFxuICAgICAgdG9kYXlTdHI6ICcnICsgeWVhciArIChtb250aCA+IDEwID8gbW9udGggKyAxIDogJzAnICsgKG1vbnRoICsgMSkpICsgKGRhdGUgPCA5ID8gJzAnICsgZGF0ZSA6IGRhdGUpXG4gICAgfSlcbiAgfSxcbiAgZGF0ZUluaXQ6IGZ1bmN0aW9uIChzZXRZZWFyOiBhbnksIHNldE1vbnRoOiBhbnkpIHtcbiAgICAvL+WFqOmDqOaXtumXtOeahOaciOS7vemDveaYr+aMiTB+MTHln7rlh4bvvIzmmL7npLrmnIjku73miY0rMVxuICAgIGxldCBkYXRlQXJyID0gW107ICAgICAgICAgICAgICAgICAgICAgICAvL+mcgOimgemBjeWOhueahOaXpeWOhuaVsOe7hOaVsOaNrlxuICAgIGxldCBhcnJMZW4gPSAwOyAgICAgICAgICAgICAgICAgICAgICAgICAvL2RhdGVBcnLnmoTmlbDnu4Tplb/luqZcbiAgICBsZXQgbm93ID0gc2V0WWVhciA/IG5ldyBEYXRlKHNldFllYXIsIHNldE1vbnRoKSA6IG5ldyBEYXRlKCk7XG4gICAgbGV0IHllYXIgPSBzZXRZZWFyIHx8IG5vdy5nZXRGdWxsWWVhcigpO1xuICAgIGxldCBuZXh0WWVhciA9IDA7XG4gICAgbGV0IG1vbnRoID0gc2V0TW9udGggfHwgbm93LmdldE1vbnRoKCk7ICAgICAgICAgICAgICAgICAvL+ayoeaciSsx5pa55L6/5ZCO6Z2i6K6h566X5b2T5pyI5oC75aSp5pWwXG4gICAgbGV0IG5leHRNb250aCA9IChtb250aCArIDEpID4gMTEgPyAxIDogKG1vbnRoICsgMSk7XG4gICAgbGV0IHN0YXJ0V2VlayA9IG5ldyBEYXRlKHllYXIgKyAnLCcgKyAobW9udGggKyAxKSArICcsJyArIDEpLmdldERheSgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nm67moIfmnIgx5Y+35a+55bqU55qE5pif5pyfXG4gICAgbGV0IGRheU51bXMgPSBuZXcgRGF0ZSh5ZWFyLCBuZXh0TW9udGgsIDApLmdldERhdGUoKTsgICAgICAgICAgICAgICAvL+iOt+WPluebruagh+aciOacieWkmuWwkeWkqVxuICAgIGxldCBvYmogPSB7fTtcbiAgICBsZXQgbnVtID0gMDtcbiAgICBpZiAobW9udGggKyAxID4gMTEpIHtcbiAgICAgIG5leHRZZWFyID0geWVhciArIDE7XG4gICAgICBkYXlOdW1zID0gbmV3IERhdGUobmV4dFllYXIsIG5leHRNb250aCwgMCkuZ2V0RGF0ZSgpO1xuICAgIH1cbiAgICBhcnJMZW4gPSBzdGFydFdlZWsgKyBkYXlOdW1zO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyTGVuOyBpKyspIHtcbiAgICAgIGlmIChpID49IHN0YXJ0V2Vlaykge1xuICAgICAgICBudW0gPSBpIC0gc3RhcnRXZWVrICsgMTtcbiAgICAgICAgb2JqID0ge1xuICAgICAgICAgIHRvZGF5U3RyOiAnJyArIHllYXIgKyAobW9udGggPiAxMCA/IG1vbnRoICsgMSA6ICcwJyArIChtb250aCArIDEpKSArIChudW0+OSA/IG51bSA6ICcwJyArIG51bSksXG4gICAgICAgICAgZGF0ZU51bTogbnVtLFxuICAgICAgICAgIHdlaWdodDogNVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYmogPSB7fTtcbiAgICAgIH1cbiAgICAgIGRhdGVBcnJbaV0gPSBvYmo7XG4gICAgfVxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBkYXRlQXJyOiBkYXRlQXJyXG4gICAgfSwgKCkgPT4ge1xuICAgICAgdGhpcy5yZWJ1aWxkRGF0ZUFycigpXG4gICAgfSlcbiAgICBsZXQgbm93RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgbGV0IG5vd1llYXIgPSBub3dEYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgbGV0IG5vd01vbnRoID0gbm93RGF0ZS5nZXRNb250aCgpICsgMTtcbiAgICBsZXQgbm93V2VlayA9IG5vd0RhdGUuZ2V0RGF5KCk7XG4gICAgbGV0IGdldFllYXIgPSBzZXRZZWFyIHx8IG5vd1llYXI7XG4gICAgbGV0IGdldE1vbnRoID0gc2V0TW9udGggPj0gMCA/IChzZXRNb250aCArIDEpIDogbm93TW9udGg7XG4gICAgaWYgKG5vd1llYXIgPT0gZ2V0WWVhciAmJiBub3dNb250aCA9PSBnZXRNb250aCkge1xuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgaXNUb2RheVdlZWs6IHRydWUsXG4gICAgICAgIHRvZGF5SW5kZXg6IG5vd1dlZWtcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGlzVG9kYXlXZWVrOiBmYWxzZSxcbiAgICAgICAgdG9kYXlJbmRleDogLTFcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuICAvKipcbiAgICog5LiK5pyI5YiH5o2iXG4gICAqL1xuICBsYXN0TW9udGg6IGZ1bmN0aW9uICgpIHtcbiAgICAvL+WFqOmDqOaXtumXtOeahOaciOS7vemDveaYr+aMiTB+MTHln7rlh4bvvIzmmL7npLrmnIjku73miY0rMVxuICAgIGxldCB5ZWFyID0gdGhpcy5kYXRhLm1vbnRoIC0gMiA8IDAgPyB0aGlzLmRhdGEueWVhciAtIDEgOiB0aGlzLmRhdGEueWVhcjtcbiAgICBsZXQgbW9udGggPSB0aGlzLmRhdGEubW9udGggLSAyIDwgMCA/IDExIDogdGhpcy5kYXRhLm1vbnRoIC0gMjtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgeWVhcjogeWVhcixcbiAgICAgIG1vbnRoOiAobW9udGggKyAxKVxuICAgIH0pXG4gICAgdGhpcy5kYXRlSW5pdCh5ZWFyLCBtb250aCk7XG4gIH0sXG4gIC8qKlxuICAgKiDkuIvmnIjliIfmjaJcbiAgICovXG4gIG5leHRNb250aDogZnVuY3Rpb24gKCkge1xuICAgIC8v5YWo6YOo5pe26Ze055qE5pyI5Lu96YO95piv5oyJMH4xMeWfuuWHhu+8jOaYvuekuuaciOS7veaJjSsxXG4gICAgbGV0IHllYXIgPSB0aGlzLmRhdGEubW9udGggPiAxMSA/IHRoaXMuZGF0YS55ZWFyICsgMSA6IHRoaXMuZGF0YS55ZWFyO1xuICAgIGxldCBtb250aCA9IHRoaXMuZGF0YS5tb250aCA+IDExID8gMCA6IHRoaXMuZGF0YS5tb250aDtcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgeWVhcjogeWVhcixcbiAgICAgIG1vbnRoOiAobW9udGggKyAxKVxuICAgIH0pXG4gICAgdGhpcy5kYXRlSW5pdCh5ZWFyLCBtb250aCk7XG4gIH0sXG4gIHJlYnVpbGREYXRlQXJyKCkge1xuICAgIGNvbnN0IGNoZWNrZWREYXRlID0gdGhpcy5nZXRDaGVja2VkRGF0ZSgpXG4gICAgY29uc3QgZGF0ZUFyciA9IHRoaXMuZGF0YS5kYXRlQXJyLm1hcCgoaXRlbTogYW55KT0+IHtcbiAgICAgIGlmIChpdGVtLnRvZGF5U3RyKSB7XG4gICAgICAgIGl0ZW0uaXNDaGVja2VkID0gY2hlY2tlZERhdGUuaW5kZXhPZihpdGVtLnRvZGF5U3RyKSAhPT0gLTE7XG4gICAgICAgIHJldHVybiBpdGVtIFxuICAgICAgfVxuICAgIH0pXG4gICAgdGhpcy5zZXREYXRhKHtkYXRlQXJyOiBkYXRlQXJyfSlcbiAgfSxcbiAgb25DbGlja0RhdGUoKSB7XG4gICAgY29uc29sZS5sb2coJ29uQ2xpY2tEYXRlJylcbiAgfSxcbiAgZ2V0Q2hlY2tlZERhdGUoKSB7XG4gICAgY29uc29sZS5sb2coJ2dldENoZWNrZWREYXRlJylcbiAgICByZXR1cm4gW1xuICAgICAgXCIyMDIwMDExMVwiLFxuICAgICAgXCIyMDIwMDExMlwiLFxuICAgICAgXCIyMDIwMDExM1wiLFxuICAgICAgXCIyMDIwMDExNFwiLFxuICAgICAgXCIyMDIwMDExNVwiLFxuICAgICAgXCIyMDIwMDExNlwiLFxuICAgICAgXCIyMDIwMDExOVwiXG4gICAgXVxuICB9LFxuICBnZXRVc2VySW5mbyhlOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZyhlKVxuICAgIGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvID0gZS5kZXRhaWwudXNlckluZm9cbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgdXNlckluZm86IGUuZGV0YWlsLnVzZXJJbmZvLFxuICAgICAgaGFzVXNlckluZm86IHRydWUsXG4gICAgfSlcbiAgfSxcbn0pXG4iXX0=